<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>KOMBO 技能卡測試</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f9f9f9; margin: 20px; }
    .btn { padding: 10px 20px; background: orange; border: none; color: white; font-size: 16px; border-radius: 6px; margin: 10px; cursor: pointer; }
    .preview-container { margin-top: 20px; }
    #cardPreview img { border: 2px solid #ccc; border-radius: 8px; max-width: 100%; }
  </style>
</head>
<body>
  <h2>KOMBO 技能卡測試</h2>
  <button class="btn" onclick="generateSkillCard()">產生技能卡</button>
  <button class="btn" onclick="shareToInstagram()">下載技能卡</button>

  <div id="cardPreview" class="preview-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    function generateSkillCard() {
      const html = `
        <div id="cardArea" style="
          position: relative;
          width: 320px;
          aspect-ratio: 2/3;
          background: url('https://i.imgur.com/0ZzYz2X.png') no-repeat center center;
          background-size: cover;
          font-family: sans-serif;
          border: 2px solid #000;
        ">
          <div style="position: absolute; top: 20px; width: 100%; text-align: center; font-weight: bold; font-size: 24px;">XXXXXXXX</div>
          <div style="position: absolute; top: 60px; width: 100%; text-align: center; font-size: 18px;">羽球技能卡</div>
          <div style="position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 16px;">售價：$450 元</div>
        </div>
      `;

      const preview = document.getElementById('cardPreview');
      preview.innerHTML = '';
      const old = document.getElementById('hiddenCard');
      if (old) old.remove();

      const wrapper = document.createElement('div');
      wrapper.innerHTML = html;
      const cardElement = wrapper.firstElementChild;
      preview.appendChild(cardElement);

      const hidden = cardElement.cloneNode(true);
      hidden.id = 'hiddenCard';
      hidden.style.position = 'absolute';
      hidden.style.top = '-9999px';
      hidden.style.left = '-9999px';
      hidden.style.transform = 'none';
      hidden.style.transformOrigin = 'unset';
      document.body.appendChild(hidden);
    }

    function shareToInstagram() {
      setTimeout(() => {
        const tempCard = document.getElementById('hiddenCard');
        if (!tempCard) {
          alert("仍然無法取得技能卡內容，請稍後再試");
          return;
        }

        html2canvas(tempCard, {
          scale: 3,
          useCORS: true,
          backgroundColor: null
        }).then(canvas => {
          const imageUrl = canvas.toDataURL("image/png");
          const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

          if (isMobile) {
            document.getElementById("cardPreview").innerHTML = `
              <p><strong>📸 長按圖片可儲存後再分享到 IG</strong></p>
              <img src="${imageUrl}">
            `;
            alert("請長按圖片儲存到相簿，再分享至 IG 🧡");
          } else {
            const link = document.createElement('a');
            link.download = 'KOMBO_技能卡.png';
            link.href = imageUrl;
            link.click();
          }

          tempCard.remove();
        });
      }, 100);
    }
  </script>
</body>
</html>
