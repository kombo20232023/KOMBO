<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>KOMBO 技能升級模擬器</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ===== 全局樣式 ===== */
    body {
      font-family: Arial, sans-serif;
      background-image: url('背景.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .logo {
      width: 120px;
      margin: 10px auto;
      display: block;
    }
    .kcoin {
      font-size: 24px;
      color: #004080;
      margin-bottom: 20px;
    }

    /* ===== 開場 Intro Modal ===== */
    #introModal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: white;
      z-index: 9999;
      padding: 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: left;
    }
    #introModal h2 {
      color: #f60;
      margin-bottom: 10px;
    }
    #introModal ol {
      margin-left: 20px;
    }
    #introModal a {
      color: #0066cc;
      font-weight: bold;
      text-decoration: underline;
    }
    #introModal button {
      background: #f60;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    /* ===== 技能升級區 ===== */
    .skill-block {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }
    .skill-name {
      font-size: 18px;
      color: #004080;
      width: 30%;
      text-align: left;
    }
    .skill-level {
      font-size: 18px;
      width: 20%;
    }
    .btn-group {
      display: flex;
      gap: 5px;
      width: 50%;
      justify-content: flex-end;
    }
    /* 升級按鈕：藍色 */
    .btn.upgrade {
      background: #FF7E00;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
      width: 50%;
      font-size: 14px;
    }
    /* 降級按鈕：橘色 */
    .btn.downgrade {
      background: #0066cc;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
      width: 50%;
      font-size: 14px;
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* ===== 下方工具按鈕 ===== */
    .tools {
      margin-top: 30px;
    }
    .tools button {
      margin: 0 8px;
      padding: 10px 18px;
      background: #0066cc;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    /* ===== Modal 推薦卡片彈窗 ===== */
    .modal-overlay {
      display: none; /* JS 控制顯示或隱藏 */
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: rgba(0,0,0,0.5);
      z-index: 9998;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      max-width: 320px;
      width: 90%;
      padding: 20px;
      text-align: center;
      position: relative;
      animation: fadeInModal 0.3s ease-out;
    }
    @keyframes fadeInModal {
      from { opacity: 0; transform: translateY(-20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .modal-content img {
      max-width: 80%;
      height: auto;
      margin-bottom: 12px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .modal-content h3 {
      color: #D35400;
      margin-bottom: 8px;
      font-size: 18px;
    }
    .modal-content p {
      margin: 6px 0;
      line-height: 1.4;
      font-size: 14px;
      color: #333;
    }
    .modal-close-btn {
      margin-top: 12px;
      padding: 8px 16px;
      background: #0066CC;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    /* ===== 下方所有符合條件的卡片：Flex 容器 ===== */
    .product-recommend {
      margin-top: 40px;
      display: flex;
      flex-wrap: wrap;           /* 超出寬度時自動換行 */
      justify-content: center;   /* 卡片置中對齊 */
      gap: 16px;                 /* 卡片之間的間距 */
      padding: 0 10px;
      box-sizing: border-box;
    }

    /* ===== 單張產品卡片樣式 ===== */
    .product {
      background-color: #FFF8E1;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px;
      margin: 0;                    /* 交由父容器的 gap 決定間距 */
      max-width: 300px;             /* 卡片最大寬度 */
      width: 100%;                  /* 在 Flex 下會根據父容器空間調整 */
      flex: 1 1 280px;              /* 最小 280px 寬度，畫面寬度足夠時可放大 */
      text-align: center;
      animation: fadeIn 0.4s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .product img {
      display: block;
      margin: 0 auto 12px;
      max-width: 80%;
      height: auto;
      border-radius: 8px;
    }
    .product h3 {
      color: #D35400;
      margin-bottom: 8px;
      font-size: 18px;
    }
    .product p {
      margin: 6px 0;
      line-height: 1.4;
      font-size: 14px;
      color: #333;
    }
    .product a {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 18px;
      background: linear-gradient(90deg, #FF7E00, #D35400);
      color: #fff;
      border: none;
      border-radius: 6px;
      text-decoration: none;
      font-size: 15px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: opacity 0.2s;
    }
    .product a:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <!-- ===== 開場彈窗 ===== -->
  <div id="introModal">
    <div style="max-width:500px">
      <h2>🎮 KOMBO 技能升級模擬器</h2>
      <p><strong>遊玩前的注意事項：</strong></p>
      <ol style="margin-left:20px;">
        <li>此評分系統僅供參考，為 KOMBO 的內部統計資料，不代表每位球友的實際使用感受，請帶著輕鬆的心情遊玩！</li>
        <li>所有價格為 <strong>2025.6.11</strong> 統計之結果，若未來毛片成本或售價調整，初始金額也會有所變動。若小編來不及更新，還請大家見諒！</li>
      </ol>
      <p>📩 有任何建議歡迎到  
        <a href="https://www.instagram.com/kombo_2023?igsh=bGU4dGdia3F5NWM5&utm_source=qr" target="_blank">
          KOMBO IG
        </a> 私訊我們喔！
      </p>
      <div style="text-align:center; margin-top:20px;">
        <button onclick="startGame()">同意</button>
      </div>
    </div>
  </div>

  <!-- ===== LOGO & K 幣 ===== -->
  <img src="LOGO.jpg" class="logo" alt="KOMBO Logo">
  <div class="kcoin">目前已花費 K幣：<span id="kcoin">450</span></div>

  <!-- ===== 技能區 ===== -->
  <div class="skill-block">
    <div class="skill-name">手感</div>
    <div class="skill-level" id="lv-touch">Lv.1</div>
    <div class="btn-group">
      <button class="btn upgrade" id="up-touch" onclick="upgrade('touch')">升級（+10 K幣）</button>
      <button class="btn downgrade" onclick="downgrade('touch')">降級（-10 K幣）</button>
    </div>
  </div>
  <div class="skill-block">
    <div class="skill-name">耐打</div>
    <div class="skill-level" id="lv-durability">Lv.1</div>
    <div class="btn-group">
      <button class="btn upgrade" id="up-durability" onclick="upgrade('durability')">升級（+10 K幣）</button>
      <button class="btn downgrade" onclick="downgrade('durability')">降級（-10 K幣）</button>
    </div>
  </div>
  <div class="skill-block">
    <div class="skill-name">飛行</div>
    <div class="skill-level" id="lv-flight">Lv.1</div>
    <div class="btn-group">
      <button class="btn upgrade" id="up-flight" onclick="upgrade('flight')">升級（+10 K幣）</button>
      <button class="btn downgrade" onclick="downgrade('flight')">降級（-10 K幣）</button>
    </div>
  </div>
  <div class="skill-block">
    <div class="skill-name">外觀</div>
    <div class="skill-level" id="lv-look">Lv.1</div>
    <div class="btn-group">
      <button class="btn upgrade" id="up-look" onclick="upgrade('look')">升級（+10 K幣）</button>
      <button class="btn downgrade" onclick="downgrade('look')">降級（-10 K幣）</button>
    </div>
  </div>

  <!-- ===== 工具按鈕 ===== -->
  <div class="tools">
    <button onclick="shareToInstagram()">📸 分享至 Instagram</button>
    <button onclick="resetAll()">🔄 重置</button>
  </div>

  <!-- ===== Modal 推薦彈窗 ===== -->
  <div class="modal-overlay" id="recommendModal">
    <div class="modal-content" id="modalContent">
      <h3>🎯 適合你的球：<span id="modalName"></span></h3>
      <img id="modalImg" src="" alt="產品圖">
      <p id="modalDesc"></p>
      <p><strong>售價：</strong>$<span id="modalPrice"></span>/筒</p>
      <p>
        手感 Lv.<span id="modalTouch"></span> ｜ 
        耐打 Lv.<span id="modalDurability"></span> ｜ 
        飛行 Lv.<span id="modalFlight"></span> ｜ 
        外觀 Lv.<span id="modalLook"></span>
      </p>
      <button class="modal-close-btn" id="closeModalBtn">關閉</button>
    </div>
  </div>

  <!-- ===== 下方產品卡片區 ===== -->
  <div class="product-recommend" id="productDisplay">
    <!-- JS 會把所有符合條件的 <div class="product">…</div> 動態插入到這裡 -->
  </div>

  <!-- ===== 點擊音效 ===== -->
  <audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f7998b6be6.mp3?filename=click-124467.mp3"></audio>

  <script>
    // ============== 全局狀態 ==============
    let kcoin = 450;
    const maxLevel = 5;
    const skills = { touch: 1, durability: 1, flight: 1, look: 1 };
    const display = {
      touch: document.getElementById("lv-touch"),
      durability: document.getElementById("lv-durability"),
      flight: document.getElementById("lv-flight"),
      look: document.getElementById("lv-look")
    };
    let soundOn = true;

    // 記錄「已經彈過 Modal 的產品名稱」，避免重複彈窗
    let hasShownModalFor = new Set();

    // ===== 產品列表（由高價到低價排序） =====
    const products = [
      {
        name: "K3A",
        price: 720,
        touch: 5,
        durability: 5,
        flight: 5,
        look: 4,
        image: "K3A.jpg",
        desc: "使用三、四級鵝毛，鵝毛毛桿較為細長，大毛中的方頭毛始於韌性高且結實！搭配上特調的高回復性膠水，讓球不因打擊而鬆散！",
        link: "https://lin.ee/syEA7iU"
      },
      {
        name: "K3",
        price: 720,
        touch: 5,
        durability: 5,
        flight: 4.5,
        look: 4.5,
        image: "K3.jpg",
        desc: "選用一、二級刺骨鴨潔白毛片，特選的部位，特選膠水，使耐打度更上一階，同時將球頭的密度提升，使手感更加扎實，飛行更加穩定。",
        link: "https://lin.ee/syEA7iU"
      },
      {
        name: "K5+",
        price: 635,
        touch: 4,
        durability: 4,
        flight: 4,
        look: 4,
        image: "K5+.jpg",
        desc: "選用正三級的刺骨鴨，相較於一二級毛片較黃，略有細微瑕疵，整體兼具耐用表現與親民價格。",
        link: "https://lin.ee/syEA7iU"
      },
      {
        name: "K5A",
        price: 630,
        touch: 4,
        durability: 4,
        flight: 3.5,
        look: 3,
        image: "K5A.jpg",
        desc: "使用四、五級鵝毛，仍選用特定的部位，讓質量能達到一定的水準，搭配上高彈性的膠水，使飛行穩定又兼顧好的手感！",
        link: "https://lin.ee/syEA7iU"
      },
      {
        name: "K5",
        price: 595,
        touch: 4,
        durability: 3.5,
        flight: 3.5,
        look: 2,
        image: "K5.jpg",
        desc: "選用毛桿Q彈、羽翼厚實的三、四級刺骨鴨，搭配特調膠水，使手感舒適不生硬，更不容易斷毛好控制，穩定飛行，是高性價比的首選。",
        link: "https://lin.ee/syEA7iU"
      },
      {
        name: "KC",
        price: 560,
        touch: 4,
        durability: 3,
        flight: 4,
        look: 2,
        image: "KC.jpg",
        desc: "使用天然五級鵝毛，雖然毛色的整潔度不是精選，但具有正常鵝毛的穩定性與耐打度，搭配上複合式膠水，打感舒適，好控球。",
        link: "https://lin.ee/syEA7iU"
      },
      {
        name: "K7pro",
        price: 480,
        touch: 2,
        durability: 4,
        flight: 2,
        look: 2,
        image: "K7PRO.jpg",
        desc: "使用一、二級鵝大刀，若能接受飛行沒那麼穩定的話，可以試試這款球。",
        link: "https://lin.ee/syEA7iU"
      }
    ];

    // ============== 音效播放 ==============
    function playSound() {
      if (soundOn) {
        document.getElementById("clickSound").play();
      }
    }

    // ============== 升級／降級 ==============
    function upgrade(skill) {
      // 如果技能未滿且 K 幣 ≥ 10，就可升 0.5 級，K 幣 +10
      if (skills[skill] < maxLevel && kcoin >= 10) {
        skills[skill] += 0.5;
        kcoin += 10;
        playSound();
        updateDisplay(skill);
        saveState();
      }
    }
    function downgrade(skill) {
      if (skills[skill] > 1) {
        skills[skill] -= 0.5;
        kcoin -= 10;
        playSound();
        updateDisplay(skill);
        saveState();
      }
    }

    // ============== 更新畫面顯示 ==============
    function updateDisplay(skill) {
      // 更新 K 幣數字
      document.getElementById("kcoin").textContent = kcoin;
      // 更新單一技能的等級文字
      display[skill].textContent = (skills[skill] >= maxLevel) ? "已滿等" : ("Lv." + skills[skill]);
      // 如果該技能已滿或 K 幣不足 10，就禁用對應的「升級」按鈕
      document.getElementById("up-" + skill).disabled = (skills[skill] >= maxLevel || kcoin < 10);
      // 每次更新都嘗試觸發 Modal 或渲染下方卡片
      checkProductMatch();
    }

    // ============== 分享至 Instagram（或複製至剪貼簿） ==============
    function shareToInstagram() {
      // 準備要分享的文字
      const shareText = `我在 KOMBO 升級模擬器中點出了：\n手感 Lv.${skills.touch}、耐打 Lv.${skills.durability}、飛行 Lv.${skills.flight}、外觀 Lv.${skills.look}\n總共花費：${kcoin} K 幣！`;
      // 如果瀏覽器支援 Web Share API，就直接呼叫
      if (navigator.share) {
        navigator.share({
          title: "KOMBO 技能升級模擬器",
          text: shareText
        }).catch((err) => {
          // 如果使用者取消分享或發生錯誤，就 fallback 複製
          copyFallback();
        });
      } else {
        // 不支援 Web Share，就 fallback 複製文字到剪貼簿
        copyFallback();
      }

      // Fallback 的函式：把 shareText 複製到剪貼簿，並跳出提示
      function copyFallback() {
        navigator.clipboard.writeText(shareText).then(() => {
          alert("已複製分享文字到剪貼簿，請貼到 Instagram 分享 😊");
        }).catch(() => {
          alert("無法複製到剪貼簿，請手動將以下文字複製並貼至 Instagram：\n\n" + shareText);
        });
      }
    }

    // ============== 重新設定 & 存 / 載 本地化狀態 ==============
    function saveState() {
      localStorage.setItem("kombo_skills", JSON.stringify({ kcoin, skills }));
    }
    function loadSaved() {
      // 清空 localStorage，回到初始狀態
      localStorage.removeItem("kombo_skills");
      kcoin = 450;
      skills.touch = skills.durability = skills.flight = skills.look = 1;
      for (let key in skills) {
        updateDisplay(key);
      }
      hasShownModalFor.clear(); // 清除曾經彈過的產品記錄
    }

    // ▶ **新增 resetAll()：按下重置時呼叫 loadSaved()（並順便關閉 Modal）**
    function resetAll() {
      loadSaved();
      // 如果 Modal 還在開，就先關閉
      const modalOverlay = document.getElementById("recommendModal");
      modalOverlay.style.display = "none";
      // 重新渲染一下下方卡片
      renderAllMatchingCards();
    }

    // ============== 點擊「開始遊戲」按鈕後，隱藏彈窗 ==============
    function startGame() {
      alert("這是一場技能的試煉——出發吧，K大師！");
      document.getElementById("introModal").style.display = "none";
      loadSaved();
    }

    // ============== Modal 彈窗與下方卡片邏輯 ==============
    const modalOverlay    = document.getElementById("recommendModal");
    const modalName       = document.getElementById("modalName");
    const modalImg        = document.getElementById("modalImg");
    const modalDesc       = document.getElementById("modalDesc");
    const modalPrice      = document.getElementById("modalPrice");
    const modalTouch      = document.getElementById("modalTouch");
    const modalDurability = document.getElementById("modalDurability");
    const modalFlight     = document.getElementById("modalFlight");
    const modalLook       = document.getElementById("modalLook");
    const closeModalBtn   = document.getElementById("closeModalBtn");

    // 點擊「關閉 Modal」後，隱藏，但同時把下方卡片全部渲染出來
    closeModalBtn.addEventListener("click", () => {
      modalOverlay.style.display = "none";
      renderAllMatchingCards();
    });

    // 每次技能或 K 幣更新，都呼叫此函式來檢查是否要彈 Modal
    function checkProductMatch() {
      // 只以「技能條件符合」來決定是否彈窗
      for (let prod of products) {
        const matchSkill = (
          skills.touch >= prod.touch &&
          skills.durability >= prod.durability &&
          skills.flight >= prod.flight &&
          skills.look >= prod.look
        );
        if (matchSkill && !hasShownModalFor.has(prod.name)) {
          // 標記此產品已經彈過一次 Modal，不要再重複彈
          hasShownModalFor.add(prod.name);

          // 填入 Modal 內容
          modalName.textContent       = prod.name;
          modalImg.src                = prod.image;
          modalImg.alt                = prod.name;
          modalDesc.textContent       = prod.desc;
          modalPrice.textContent      = prod.price;
          modalTouch.textContent      = prod.touch;
          modalDurability.textContent = prod.durability;
          modalFlight.textContent     = prod.flight;
          modalLook.textContent       = prod.look;

          // 顯示遮罩 + 彈窗
          modalOverlay.style.display = "flex";
          return; // 只彈第一個符合技能條件的產品
        }
      }

      // 沒有新的「須彈窗」產品，就渲染所有符合「技能 或 價格」條件的卡片
      renderAllMatchingCards();
    }

    // 渲染下方「所有符合條件的產品卡片」
    function renderAllMatchingCards() {
      const p = document.getElementById("productDisplay");
      p.innerHTML = ""; // 清空

      products.forEach((prod) => {
        const matchSkill = (
          skills.touch >= prod.touch &&
          skills.durability >= prod.durability &&
          skills.flight >= prod.flight &&
          skills.look >= prod.look
        );
        const matchPrice = (kcoin >= prod.price);

        // 下方卡片依然保留「技能門檻或價格門檻」其中之一即可顯示
        if (matchSkill || matchPrice) {
          const cardHtml = `
            <div class="product">
              <h3>🎯 適合你的球：${prod.name}</h3>
              <img src="${prod.image}" alt="${prod.name}">
              <p><strong>商品名稱：</strong>KOMBO ${prod.name}</p>
              <p>${prod.desc}</p>
              <p><strong>售價：</strong>$${prod.price}/筒</p>
              <p>
                手感 Lv.${prod.touch} ｜ 
                耐打 Lv.${prod.durability} ｜ 
                飛行 Lv.${prod.flight} ｜ 
                外觀 Lv.${prod.look}
              </p>
              <a href="${prod.link}" target="_blank">前往賣場</a>
            </div>
          `;
          p.innerHTML += cardHtml;
        }
      });
    }

    // 畫面第一次載入時，先把狀態初始化，再檢查是否要彈 Modal / 渲染卡片
    window.addEventListener("DOMContentLoaded", () => {
      loadSaved();
      checkProductMatch();
    });
  </script>
</body>
</html>
